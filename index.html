<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì FIB-4 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö NAFLD</title>

  <!-- ‚úÖ PWA Config -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-512.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }
    .card { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
    .input-field { border: 1px solid #cbd5e1; padding: 10px; border-radius: 8px; transition: border-color 0.3s; }
    .input-field:focus { border-color: #3b82f6; outline: none; }
  </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

  <div class="w-full max-w-lg bg-white p-6 sm:p-8 rounded-xl card">
    <img src="icons/logo.png" alt="" class="mx-auto mb-4 w-20">
    <h1 class="text-3xl font-bold text-gray-800 mb-2 text-center">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì FIB-4</h1>
    <p class="text-center text-gray-600 mb-6">
      ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏†‡∏≤‡∏ß‡∏∞‡∏û‡∏±‡∏á‡∏ú‡∏∑‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ö (Advanced Fibrosis) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ NAFLD/MASLD
    </p>

    <!-- Input Form -->
    <div class="space-y-4">
      <label class="block">
        <span class="text-gray-700 font-semibold">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</span>
        <input type="number" id="inputAge" class="mt-1 block w-full input-field" min="1" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 45">
      </label>
      <label class="block">
        <span class="text-gray-700 font-semibold">‡∏Ñ‡πà‡∏≤ AST (U/L)</span>
        <input type="number" id="inputAST" class="mt-1 block w-full input-field" min="1" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 35">
      </label>
      <label class="block">
        <span class="text-gray-700 font-semibold">‡∏Ñ‡πà‡∏≤ ALT (U/L)</span>
        <input type="number" id="inputALT" class="mt-1 block w-full input-field" min="1" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 30">
      </label>
      <label class="block">
        <span class="text-gray-700 font-semibold">‡πÄ‡∏Å‡∏•‡πá‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î (10‚Åπ/L)</span>
        <input type="number" id="inputPlatelets" class="mt-1 block w-full input-field" min="10" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 250">
      </label>
    </div>

    <button onclick="calculateFIB4()" 
      class="w-full mt-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition">
      ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì FIB-4
    </button>

    <div id="resultContainer" class="mt-8 p-5 rounded-xl border-2 border-gray-200 hidden">
      <h2 class="text-xl font-bold mb-3 text-gray-800">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
      <p id="fib4Score" class="text-2xl font-mono mb-4 text-center"></p>
      <div id="riskDisplay" class="p-4 rounded-lg text-center font-bold"></div>
      <div id="recommendation" class="mt-4 text-gray-700"></div>
    </div>

    <p class="text-xs text-gray-400 mt-6 text-center">
      *‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÑ‡∏î‡πâ
    </p>

    <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ -->
    <button id="installBtn" 
      class="hidden w-full mt-4 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition">
      ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå üì±
    </button>
  </div>

  <script>
    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì FIB-4
    function calculateFIB4() {
      const age = parseFloat(document.getElementById('inputAge').value);
      const ast = parseFloat(document.getElementById('inputAST').value);
      const alt = parseFloat(document.getElementById('inputALT').value);
      const platelets = parseFloat(document.getElementById('inputPlatelets').value);

      if (isNaN(age) || isNaN(ast) || isNaN(alt) || isNaN(platelets) || age <= 0 || ast <= 0 || alt <= 0 || platelets <= 0) {
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á");
        return;
      }

      const fib4 = (age * ast) / (platelets * Math.sqrt(alt));
      const rounded = fib4.toFixed(2);

      let risk, color, rec;
      if (fib4 < 1.3) {
        risk = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ (Low Risk)";
        color = "bg-green-100 text-green-800";
        rec = "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏£‡∏ß‡∏à FIB-4 ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô 2‚Äì3 ‡∏õ‡∏µ";
      } else if (fib4 <= 2.67) {
        risk = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Indeterminate)";
        color = "bg-yellow-100 text-yellow-800";
        rec = "‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à LSM (FibroScan / MRE)";
      } else {
        risk = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á (High Risk)";
        color = "bg-red-100 text-red-800";
        rec = "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡∏ï‡∏±‡∏ö";
      }

      document.getElementById('resultContainer').classList.remove('hidden');
      document.getElementById('fib4Score').textContent = `FIB-4 Score: ${rounded}`;
      document.getElementById('riskDisplay').className = `p-4 rounded-lg text-center font-bold ${color}`;
      document.getElementById('riskDisplay').textContent = risk;
      document.getElementById('recommendation').textContent = rec;
    }

    // ‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(() => console.log('‚úÖ Service Worker registered'))
          .catch(err => console.error('‚ùå', err));
      });
    }

    // ‚úÖ Add to Home Screen (A2HS)
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove('hidden');
    });

    installBtn.addEventListener('click', async () => {
      installBtn.classList.add('hidden');
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`User response: ${outcome}`);
      deferredPrompt = null;
    });
  </script>
</body>
</html>
